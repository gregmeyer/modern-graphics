name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          pip install -e .
          pip install pytest
          playwright install chromium
      - name: Run basic test
        run: |
          python3 -c "from modern_graphics import ModernGraphicsGenerator, Attribution; print('âœ“ Import successful')"
      - name: Enforce create-default references
        run: |
          python3 scripts/check_create_default_refs.py
      - name: Run overhaul validator
        run: |
          python3 scripts/validate_overhaul_phase1.py
      - name: Run smoke tests (Phase 1-5)
        run: |
          pytest -q \
            tests/smoke/test_overhaul_phase1_smoke.py \
            tests/smoke/test_layout_strategy_smoke.py \
            tests/smoke/test_create_cli_phase3_smoke.py \
            tests/smoke/test_create_story_regression_phase7_smoke.py \
            tests/smoke/test_export_phase4_smoke.py \
            tests/smoke/test_cli_migration_phase5_smoke.py \
            tests/smoke/test_export_presets_phase6_smoke.py
